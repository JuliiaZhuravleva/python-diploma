<!-- backend/templates/admin/dashboard.html -->
{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
  {{ block.super }}
  <style>
    .dashboard-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .dashboard-card {
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    .dashboard-card h3 {
      margin-top: 0;
      color: #417690;
    }
    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #333;
    }
    .stat-label {
      font-size: 0.9em;
      color: #666;
    }
    .stat-list {
      list-style: none;
      padding-left: 0;
    }
    .stat-list li {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }
  </style>
{% endblock %}

{% block content %}
  <h1>{% trans "Панель управления" %}</h1>

  <div class="dashboard-container">
    <!-- Карточка с общей статистикой -->
    <div class="dashboard-card">
      <h3>{% trans "Общая статистика" %}</h3>
      <div>
        <div class="stat-value">{{ total_users }}</div>
        <div class="stat-label">{% trans "Всего пользователей" %}</div>
      </div>
      <div style="margin-top: 15px;">
        <div class="stat-value">{{ active_users }}</div>
        <div class="stat-label">{% trans "Активных пользователей" %}</div>
      </div>
    </div>

    <!-- Карточка с статистикой заказов -->
    <div class="dashboard-card">
      <h3>{% trans "Заказы" %}</h3>
      <div>
        <div class="stat-value">{{ total_orders }}</div>
        <div class="stat-label">{% trans "Всего заказов" %}</div>
      </div>
      <div style="margin-top: 15px;">
        <div class="stat-value">{{ recent_orders_count }}</div>
        <div class="stat-label">{% trans "Заказов за последний месяц" %}</div>
      </div>
    </div>

    <!-- Карточка со статусами заказов -->
    <div class="dashboard-card">
      <h3>{% trans "Статусы заказов" %}</h3>
      <ul class="stat-list">
        {% for status in orders_by_status %}
          <li>
            <span>
              {% if status.state == 'new' %}
                {% trans "Новый" %}
              {% elif status.state == 'confirmed' %}
                {% trans "Подтвержден" %}
              {% elif status.state == 'assembled' %}
                {% trans "Собран" %}
              {% elif status.state == 'sent' %}
                {% trans "Отправлен" %}
              {% elif status.state == 'delivered' %}
                {% trans "Доставлен" %}
              {% elif status.state == 'canceled' %}
                {% trans "Отменен" %}
              {% else %}
                {{ status.state }}
              {% endif %}
            </span>
            <span>{{ status.count }}</span>
          </li>
        {% endfor %}
      </ul>
    </div>

    <!-- Карточка с популярными товарами -->
    <div class="dashboard-card">
      <h3>{% trans "Популярные товары" %}</h3>
      <ul class="stat-list">
        {% for product in popular_products %}
          <li>
            <span>{{ product.name }}</span>
            <span>{{ product.order_count }}</span>
          </li>
        {% empty %}
          <li>{% trans "Нет данных" %}</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div style="margin-top: 20px;">
    <a href="{% url 'admin:backend_order_changelist' %}" class="button">
      {% trans "Управление заказами" %}
    </a>
    <a href="{% url 'admin:backend_user_changelist' %}" class="button" style="margin-left: 10px;">
      {% trans "Управление пользователями" %}
    </a>
    <a href="{% url 'admin:admin-import-export' %}" class="button" style="margin-left: 10px;">
      {% trans "Импорт/экспорт данных" %}
    </a>
  </div>
{% endblock %}
